---

copyright:
  years: 2015, 2016
lastupdated: "2016-11-03"

---
{:shortdesc: .shortdesc}

# Enabling Facebook authentication for your iOS apps (Objective-C SDK)
{: #facebook-auth-ios}

To use Facebook as an identity provider in your {{site.data.keyword.amafull}} iOS applications, add and configure the iOS Platform for your Facebook application.

{:shortdesc}

**Note:** While the Objective-C SDK remains fully supported, and is still considered the primary SDK for {{site.data.keyword.Bluemix}} Mobile Services, there are plans for discontinuing it later this year in favor of the new Swift SDK (see [Setting up the iOS Swift SDK](facebook-auth-ios-swift-sdk.html)).

## Before you begin
{: #facebook-auth-ios-before}

You must have:
* An iOS project that is set up to work with CocoaPods.  For more information, see **Install CocoaPods** in  [Setting up the iOS  SDK](https://console.{DomainName}/docs/services/mobileaccess/getting-started-ios.html).  
   **Note:** You do not need to install the core {{site.data.keyword.amashort}}  client SDK before proceeding.
* An instance of a  {{site.data.keyword.Bluemix_notm}} application that is protected by the {{site.data.keyword.amashort}} service. For more information about how to create a {{site.data.keyword.Bluemix_notm}} back-end, see [Getting started](index.html).
* Your **AppGUID** value. Open your service in the  {{site.data.keyword.amashort}} dashboard. Click the **Mobile Options** button. The  `appGUID` (also known as `tenantId`) value is displayed in the **App GUID / TenantId** field. You will need this value for intializing the Authorization Manager.
* A Facebook Application ID. For more information, see [Creating an application on the Facebook for Developers website](https://console.{DomainName}/docs/services/mobileaccess/facebook-auth-overview.html#facebook-appID).

## Configuring your Facebook Application for the iOS Platform
{: #facebook-auth-ios-config}
On the Facebook for Developers site:

1. Log in to your account on  [Facebook for Developers](https://developers.facebook.com). For information on creating a new app, see https://console.{DomainName}/docs/services/mobileaccess/facebook-auth-overview.html#facebook-appID). 

1. Ensure that the iOS platform has been added to your app. When you add or configure the iOS platform  you need to supply the **bundleId** of your iOS application. To find the **bundleId** of your iOS application, look for the **Bundle Identifier** in either the `info.plist` file or Xcode project **General** tab.

1. Click **Save Settings**.

	**Tip**: Consider enabling URL Scheme Suffix or Single Sign On if you are planning to use these features.

1. Click **Save Settings**.

## Configuring {{site.data.keyword.amashort}} for Facebook authentication
{: #facebook-auth-ios-configmca}

After you have configured the Facebook Application ID and your Facebook Application to serve iOS clients, you can enable Facebook authentication in {{site.data.keyword.amashort}}.

1. Open your service in the  {{site.data.keyword.amashort}} dashboard.
1. From the **Manage** tab, toggle **Authorization** on.
	1. Expand the **Facebook** section.
	1. Add the **Facebook Application ID** and click **Save**.

## Configuring the {{site.data.keyword.amashort}} Facebook client SDK for iOS
{: #facebook-auth-ios-sdk}

### Installing CocoaPods
{: #facebook-auth-cocoapods}

The {{site.data.keyword.amashort}} client SDK is distributed with CocoaPods, a dependency manager for iOS projects. CocoaPods automatically downloads artifacts from repositories and makes them available to your iOS application.

1. Open Terminal and run the `pod --version` command. If you already have CocoaPods installed, the version number is displayed. You can skip to the next section of this tutorial.

1. Install CocoaPods by running `sudo gem install cocoapods`. Refer to [CocoaPods website](https://cocoapods.org/) in case additional guidance is required.

### Installing the {{site.data.keyword.amashort}} Facebook client SDK with CocoaPods
{: #facebook-auth-install-cocoapods}

1. In your iOS project, edit the `Podfile` and the following line:

	```
	pod 'IMFFacebookAuthentication'
	```
{: codeblock}

1. Save the `Podfile` and run the `pod install` command from the command line. CocoaPods installs the dependencies. The progress and which components were added are displayed.
 **Important**: You now must open your project by using the `xcworkspace` file that is generated by CocoaPods. Usually the name is `{your-project-name}.xcworkspace`.  

1. Run `open {your-project-name}.xcworkspace` from command line to open your iOS project workspace.

### Configuring your iOS project for Facebook Authentication
{: #facebook-auth-ios-configproject}

1. Find the `info.plist` file, usually located under `Supporting files` folder in your Xcode project.

1. Configure Facebook integration by adding the following properties to your `info.plist` file:

	![image](images/ios-facebook-infoplist-settings.png)

You can also update the `info.plist` file by right-clicking the file, selecting **Open as > Source Code** and adding the following XML:

```XML
<key>CFBundleURLTypes</key>
<array>
	<dict>
		<key>CFBundleURLSchemes</key>
		<array>
			<string>fb{your-facebook-application-id}</string>
		</array>
	</dict>
</array>
<key>FacebookAppID</key>
<string>{your-facebook-application-id}</string>
<key>FacebookDisplayName</key>
<string>MyApp</string>
<key>LSApplicationQueriesSchemes</key>
<array>
	<string>fbauth</string>
	<string>fbauth2</string>
</array>
<key>NSAppTransportSecurity</key>
<dict>
    <key>NSExceptionDomains</key>
    <dict>
        <key>facebook.com</key>
        <dict>
            <key>NSIncludesSubdomains</key>
            <true/>
            <key>NSThirdPartyExceptionRequiresForwardSecrecy</key>
            <false/>
        </dict>
        <key>fbcdn.net</key>
        <dict>
            <key>NSIncludesSubdomains</key>
            <true/>
            <key>NSThirdPartyExceptionRequiresForwardSecrecy</key>
            <false/>
        </dict>
        <key>akamaihd.net</key>
        <dict>
            <key>NSIncludesSubdomains</key>
            <true/>
            <key>NSThirdPartyExceptionRequiresForwardSecrecy</key>
            <false/>
        </dict>
    </dict>
</dict>
```
{: codeblock}

Update the URL scheme and `FacebookappID` properties with your **Facebook Application ID**.

 **Important**: Make sure you are not overriding any existing properties in  the `info.plist` file. If you have overlapping properties, you must merge manually. For more information, see [Configure Xcode Project](https://developers.facebook.com/docs/ios/getting-started/) and [Preparing Your Apps for iOS9](https://developers.facebook.com/docs/ios/ios9).


## Initializing the {{site.data.keyword.amashort}} client SDK
{: #facebook-auth-ios-initalize}

Initialize the client SDK by passing your app's route (`applicationRoute`) and app GUID (`applicationGUID`).

A common, though not mandatory, place to put the initialization code is in the `application:didFinishLaunchingWithOptions` method of your application delegate.


1. Import required framework in the class that you want to use {{site.data.keyword.amashort}} client SDK by adding the following headers:

	####Objective-C
	{: #framework-objc}

	```Objective-C
	#import <IMFCore/IMFCore.h>
	#import <IMFFacebookAuthentication/IMFFacebookAuthenticationHandler.h>
	#import <FacebookSDK/FacebookSDK.h>
	```	

	####Swift
	{: #bridgingheader-swift}

	The {{site.data.keyword.amashort}} client SDK is implemented using Objective-C, therefore you might need to add a bridging header to your swift project.

	1. Right-click your project in Xcode and select **New File...**
		1. In the **iOS Source** category, pick `Header file`.
		1. Name it `BridgingHeader.h`.
		1. Add imports to your bridging header:

			```Objective-C
			#import <IMFCore/IMFCore.h>
			#import <IMFFacebookAuthentication/IMFFacebookAuthenticationHandler.h>
			#import <FacebookSDK/FacebookSDK.h>
			```

	1. Click your project in Xcode and select the **Build Settings** tab.
		1. Search for **Objective-C Bridging Header**.
		1. Set the value to location of your `BridgingHeader.h` file, for example: `$(SRCROOT)/MyApp/BridgingHeader.h`.
		1. Make sure your bridging header is being picked up by Xcode by building your project. You should see no failure messages.

2. Initialize the client SDK.	For information on obtaining `applicationRoute` and `applicationGUID`  see [Before you begin](#before-you-begin)).

	####Objective-C
	{: #approute-objc}

	```Objective-C
	[[IMFClient sharedInstance]
				initializeWithBackendRoute:@"applicationRoute"
			backendGUID:@"applicationGUID"];
	```

	####Swift
	{: #approute-swift}

	```Swift
	IMFClient.sharedInstance().initializeWithBackendRoute("applicationRoute",
                               backendGUID: "applicationGUID")
	```

1. Initialize the `AuthorizationManager` by passing the {{site.data.keyword.amashort}} service `tenantId` parameter. See [Before you begin].
(#before-you-begin)).

	####Objective-C
	{: #authman-objc}

	```Objective-C
	[[IMFAuthorizationManager sharedInstance]  initializeWithTenantId: @"tenantId"];
	```

	####Swift
	{: #authman-swift}

	```Swift
	IMFAuthorizationManager.sharedInstance().initializeWithTenantId("tenantId")
	```

1. Notify the Facebook SDK about the app activation and register the Facebook Authentication Handler by adding the following code to the `application:didFinishLaunchingWithOptions` method in your app delegate. Add this code after you initialize the IMFClient instance.

	####Objective-C
	{: #activate-objc}

	```Objective-C
		[FBAppEvents activateApp];
		[[IMFFacebookAuthenticationHandler sharedInstance] registerWithDefaultDelegate];
	```

	####Swift
	{: #activate-swift}

	```Swift
		FBAppEvents.activateApp()
		IMFFacebookAuthenticationHandler.sharedInstance().registerWithDefaultDelegate()
	```

1. Add the following code to your app delegate.

	####Objective-C
	{: #appdelegate-objc}

	```Objective-C
	- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url
			sourceApplication:(NSString *)sourceApplication annotation:(id)annotation {

		return [FBAppCall handleOpenURL:url sourceApplication:sourceApplication];
	}
	```

	####Swift
	{: #appdelegate-swift}

	```Swift
	func application(application: UIApplication, openURL url: NSURL,
					sourceApplication: String?, annotation: AnyObject) -> Bool {

		return FBAppCall.handleOpenURL(url, sourceApplication: sourceApplication)

	}
```


## Testing the authentication
{: #facebook-auth-ios-testing}
After the client SDK is initialized and Facebook Authentication Manager is registered, you can start making requests to your mobile backend.

### Before you begin
{: #facebook-auth-ios-testing-before}
You must be using the {{site.data.keyword.mobilefirstbp}} boilerplate and already have a resource protected by {{site.data.keyword.amashort}} at the `/protected` endpoint. If you need to set up a `/protected` endpoint, see [Protecting resources](https://console.{DomainName}/docs/services/mobileaccess/protecting-resources.html).

1. Try to send a request to protected endpoint of your newly created mobile backend in your browser. Open the following URL: `{applicationRoute}/protected`.
For example: `http://my-mobile-backend.mybluemix.net/protected`
<br/>The `/protected` endpoint of a mobile backend that was created with MobileFirst Services Starter boilerplate is protected with {{site.data.keyword.amashort}}. An `Unauthorized` message is returned in your browser. This message is returned because this endpoint can only be accessed by mobile applications that are instrumented with {{site.data.keyword.amashort}} client SDK.

1. Use your iOS application to make a request to the same endpoint.

	####Objective-C
	{: #requestpath-objc}

	```Objective-C
	NSString *requestPath = [NSString stringWithFormat:@"%@/protected",
								[[IMFClient sharedInstance] backendRoute]];

	IMFResourceRequest *request =  [IMFResourceRequest 
		requestWithPath:requestPath method:@"GET"];

	[request sendWithCompletionHandler:^(IMFResponse *response, NSError *error) {
		if (error){
			NSLog(@"Error :: %@", [error description]);
		} else {
			NSLog(@"Response :: %@", [response responseText]);
			NSLog(@"%@", [[IMFAuthorizationManager sharedInstance] userIdentity]);
		}
	}];
	```

	####Swift
	{: #requestpath-swift}

	```Swift
	let requestPath = IMFClient.sharedInstance().backendRoute + "/protected"

	let request = IMFResourceRequest(path: requestPath, method: "GET");
	request.sendWithCompletionHandler { (response, error) -> Void in
		if (nil != error){
			NSLog("Error :: %@", error.description)
		} else {
			NSLog("Response :: %@", response.responseText)
			NSLog("%@", IMFAuthorizationManager.sharedInstance().userIdentity)
		}
	};
 ```

1. Run your application. A Facebook login screen pops up.

	![image](images/ios-facebook-login.png)

	This screen might look slightly different if you do not have the Facebook app installed on your device, or if you are not currently logged in to Facebook.

1. Click **OK** to authorize {{site.data.keyword.amashort}} to use your Facebook user identity for authentication purposes.

1. 	When your request succeeds, the following output is displayed in the Xcode console:
	![image](images/ios-facebook-login-success.png)

	You can also add logout functionality by adding the following code:

	####Objective-C
	{: #logout-objc}

	```Objective-C
	[[IMFFacebookAuthenticationHandler sharedInstance] logout : callBack]
	```
{: codeblock}

	####Swift
	{: #logout-swift}

	```Swift
	IMFFacebookAuthenticationHandler.sharedInstance().logout(callBack)
	```
{: codeblock}

	If you call this code after a user is logged in with Facebook and the user tries to log in again, they are prompted to authorize {{site.data.keyword.amashort}} to use Facebook for authentication purposes.

	To switch users, you must call this code and the user must logout from Facebook in their browser.

  Passing `callBack` to the logout function is optional. You can also pass `nil`.
