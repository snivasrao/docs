---

copyright:
  years: 2016

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen:.screen}
{:codeblock:.codeblock}


# {{site.data.keyword.deliverypipeline}} の製品情報
{: #deliverypipeline_about}
最終更新日: 2016 年 8 月 29 日
{: .last-updated}

IBM&reg; Bluemix&reg;
{{site.data.keyword.deliverypipeline}} サービス (パイプラ
イン) は、Bluemix プロジェクトの継続的なデプロイメントを自動化します。
パイプラインでは、一連のステージにより入力内容を取得して、
ビルド、テスト、およびデプロイメントなどのジョブを実行します。
{:shortdesc}

以降のセクションでは、パイプラインの背景にある概念的な詳細を
説明します。

## ステージ

{: #deliverypipeline_stages}

ステージは、コードのビルド、デプロイ、およびテスト時に、入力内容とジョブを編成します。
ステージは、ソース制御リポジトリーからの入力内容を受け入
れるか、他のステージにジョブをビルドします。最初のステージを作成するときに、
**「入力」**タブにデフォルト設定がセットされ
ます。

ステージの入力内容は、含まれるジョブに渡され、各ジョブには、ジ
ョブの実行場所であるクリーンなコンテナーが与えられます。
ステージ内のジョブは、互いに成果物を渡すことはできません。

すべてのジョブで使用可能なステージ環境プロパティーを定義することができます。
例えば、単一のステージでジョブをデプロイおよびテス
トするための単一の URL を渡す `TEST_URL` プロパティーを定義することができます。
デプロイ・ジョブは、その URL にデプロイされ、テスト・ジョブは URL で実
行中のアプリをテストします。

ステージにおいてデフォルトでは、変
更がプロジェクトのソース制御リポジトリーに送信されるたび
に、ビルドとデプロイメントは自動的に実行されます。
ステージとジョブは順次実行され、作業のフロー制御を可能にします。
例えば、デプロイメント・ステージの前にテスト・ステージを配置すること
ができます。テスト・ステージでテストが失敗すると、デプロイメント・ステージ
は実行されません。

特定のステージの制御を厳しくすることができます。
入力時に変更が発生するたびにステージが実行されないようにするには、機能を無効にすることができます。**「入力」
**タブの「ステージ・トリガー」セクションで、
**「このステージが手動で実行されたときにのみジョブを実行」**をクリックします。

![「入力」タブ](./images/input_tab_only_execute.png)

## ジョブ

{: #deliverypipeline_jobs}

ジョブは、ステージ内の実行単位です。ステージには複数のジョブを含めることができ
、ステージ内のジョブは順次実行されます。デフォルトでは、ジョブが失敗すると、ステージ内の
以降のジョブは実行されません。

![ステージ内のビルド・ジョブとテ
スト・ジョブ](./images/jobs.png)

ジョブは、各パイプラインの実行用に作成された Docker コンテナー
内にある、個別の作業ディレクトリーで実行されます。
ジョブが実行される前に、その作業ディレクトリーは、ステージ・レベルで定
義される入力データを取り込みます。
例えば、テスト・ジョブとデプロイ・ジョブを含むステージがあるとします。
1 つのジョブで依存関係をインストールすると、その依存関係はもう一方のジョブ
では使用できません。ただし、ステージの入力で依存関係を使用可能にすると、どちら
のジョブでも使用可能となります。

単純タイプのビルド・ジョブを除き、ジョブを構成する際は、ビルド
・コマンド、テスト・コマンド、またはデプロイメント・コマンドを含む UNIX
シェル・スクリプトを含めることができます。
ジョブは暫定のコンテナーで実行されるため、複数のジョブが同じステージ
の一部である場合でも、1 つのジョブのアクションが他のジョブの実行環境に
影響を与えることはできません。

ジョブの実行後、そのジョブ用に作成されたコンテナーは破棄されます。
ジョブの実行結果は永続できますが、実行環境は永続しません。

**注**: ジョブは最大で 60 分実行することがで
きます。その限界を超えると、ジョブは失敗します。ジョブが限界を超えた場合は、複数の
ジョブに分割してください。例えば、1 つのジョブが 3 つのタスクを実行する場合、1 つ
のタスクに 1 つのジョブとなるように、そのジョブを 3 つのジョブに分割するこ
とができます。

ジョブをステージに追加する方法については、
[ジョブのス
テージへの追加](./build_deploy.html#deliverypipeline_add_job)を参照してください。

### ビルド・ジョブ

ビルド・ジョブは、デプロイメントに備えてプロジェクトをコンパイルします。ビルド・ジョブは、ビルド・
アーカイブ・ディレクトリーに送信することができる成果物を生成しますが
、デフォルトで成果物はプロジェクトのルート・ディレクトリーに配置され
ます。

ビルド・ジョブからの入力データをとるジョブは、ジョブが作成され
たのと同じ構造のビルド成果物を参照する必要があります。例えば、ビルド・ジョブ・アーカイブが成果物を
`output `ディレクトリーにビルドすると、デプロイ・スクリプトは、プロジェクトのルート・ディレク
トリーではなく` output `ディレクトリーを参照してコンパ
イルされたプロジェクトをデプロイします。

**注**: ビルド・ジョブのビルダー・タイプに
**「単純」**を選択する場合、ビルド
・プロセスをスキップします。この場合、コードはコンパイルされませんが、そのままデプ
ロイメント・ステージへ送信されます。ビルドとデプロイの両方を行うには、
**「単純」**以外のビルダー・タイプ
を選択してください。

#### ビルド・スクリプトの環境プロパティー
ビルド・ジョブのビルド・シェル・コマンド内に環境プロパティーを
含めることができます。このプロパティーは、ジョブの実行環境に関する情報へのアクセスを
提供します。詳しくは、
[{{site.data.keyword.deliverypipeline}}
サービスの 環境プロパティーとリソース (Environment properties and
resources for the {{site.data.keyword.deliverypipeline}}
service)](./deploy_var.html)を参照してください。

### デプロイ・ジョブ

デプロイ・ジョブは、プロジェクトをアプリとして Bluemix にアップロー
ドし、URL からアクセス可能です。プロジェクトのデプロイ後は、デプロイされたアプリを
Bluemix ダッシュボードで検索することができます。ビルド・ジョブとデプロイ・ジョブを個々の
ステージとして構成するか、同じステージに追加して自動的に実行させる
ことができます。

デプロイ・ジョブは、新規アプリをデプロイするか、既存のアプリを更新することができます。Cloud Foundry コマ
ンド・ライン・インターフェースや Web IDE の実行バーなどの別
の方法で最初にアプリをデプロイしていても、デプロイ・ジョブを使用してアプリを更新するこ
とができます。デプロイ・ジョブでアプリを更新するには、アプリの名前を使用します。

1 つ以上の地域およびサービスにデプロイできます。例えば、開発成果物が IBM Containers を使用し、1 つの地域でテストされ、複数の地域の実働環境にデプロイされるように {{site.data.keyword.deliverypipeline}} サービスをセットアップすることができます。詳細については、『[Regions](../../overview/index.html#ov_intro__reg)』を参照してください。

#### デプロイメント・スクリプトの環境プロパティー

デプロイ・ジョブのデプロイメント・スクリプト内に環境プロパティ
ーを含めることができます。このプロパティーは、ジョブの実行環境に関する情報へのアク
セスを提供します。詳しくは、
[{{site.data.keyword.deliverypipeline}}
サービスの環境プロパティーとリソース (Environment properties and
resources for the {{site.data.keyword.deliverypipeline}}
service)](./deploy_var.html)を参照してください。

### テスト・ジョブ
条件を満たすことが必要な場合は、ビルド・ジョブおよびデプロ
イ・ジョブの前か後にテスト・ジョブを組み込みます。必要に応じて、テスト・ジョブを単純タイプまた
は複雑タイプにカスタマイズすることができます。例えば、cURL コマンドを
実行して特定の応答を予期することができます。また、一連の単体テストを実行する、または
Sauce Labs などサード・パーティーのテスト・サービスを使用して機能テス
トを実行することもできます。

テストで JUnit XML 形式の結果ファイルを生成する場合、結果ファイ
ルに基づいたレポートが各テスト結果ページの**「テスト」**タブに表示されます。テストが不
合格の場合は、ジョブも失敗します。

#### テスト・スクリプトの環境プロパティー

テスト・ジョブのスクリプトに環境プロパティーを含めることができます。
このプロパティーは、ジョブの実行環境に関する情報へのアクセスを提供します。詳しくは、
[{{site.data.keyword.deliverypipeline}}
サービスの環境プロパティーとリソース (Environment properties and
resources for the {{site.data.keyword.deliverypipeline}}
service)](./deploy_var.html)を参照してください。

## マニフェスト・ファイル
{: #deliverypipeline_manifest}

マニフェスト・ファイルは、`manifest.yml` とい
う名前でプロジェクトのルート・ディレクトリーに格納されます。このファイルによって Bluemix へのプロジェクトのデプロイ方法を制御します。
プロジェクト用のマニフェスト・ファイルの作成について詳しくは、
[
アプリケーション・マニフェストに関する Bluemix の資料](https://www.ng.bluemix.net/docs/manageapps/deployingapps.html#appmanifest)を参照
してください。プロジェクトを Bluemix と統合するには、そのプロジェクトのルート
・ディレクトリーにマニフェスト・ファイルが必要です。ただし、そのファイルの情報に基づいてデプロイする必要はありません。

パイプラインでは、`cf push` コマンド引数
を使用して、マニフェスト・ファイルで可能なすべての設定を指定できます。
`cf push` コマンド引数は、複数のデプロイメント・ター
ゲットがあるプロジェクトで有用です。複数のデプロイ・ジョブがすべてプロジェクト・マニフ
ェスト・ファイルで指定されるルートを使用しようとすると、競合が発生します。

競合を避けるには、
`cf push` の後にホスト名引数、`-n`
、およびルート名を使用して、ルートを指定することができます。個々のステージでデプロイメント・スクリ
プトを変更することにより、複数のターゲットにデプロイする際のルートの競
合を回避できます。

`cf push` コマンド引数を使用するに
は、デプロイ・ジョブの構成設定を開き、**「デプロイ・スクリプ
ト」**フィールドを変更します。詳しくは、
[Cloud
Foundry Push の資料](http://docs.cloudfoundry.org/devguide/installcf/whats-new-v6.html#push)を参照
してください。

## サンプル・パイプライン
{: #deliverypipeline_example}

サンプル・パイプラインには次の 3 つのステージを含めることができ
ます。

1. アプリのビルド・プロセスをコンパイルして実行するビルド・ステージ。
2. アプリのインスタンスをデプロイして、インスタンス上でテストを実行するテスト・ステージ。
3. テスト済みのアプリの実動インスタンスをデプロイする実動ステージ。

次の概念図に、このパイプラインを示しています。

![パイプラインのステージとジョブの概念図](./images/diagram.jpg)

*3 ステージのパイプラインの概念モデル*

ステージは、その入力データをリポジトリーとビルド・ジョブから取り出し、ステージ内のジョブは、互いに独立して順次実行されます。
サンプル・パイプラインでは、テスト・ステージと実動ステージの両方がその入力
データとしてビルド・ステージの出力を取り出す場合でも、ステージは順次実行されます。

<!--
[1]: https://www.ng.bluemix.net/docs/manageapps/deployingapps.html#appmanifest
[2]: https://www.ng.bluemix.net/docs/#services/DeliveryPipeline/index.html#getstartwithCD
[3]: http://docs.cloudfoundry.org/devguide/installcf/whats-new-v6.html#push
[4]: https://console.ng.bluemix.net/?ace_base=true/#/pricing/cloudOEPaneId=pricing
[5]: ./images/open_logs.png
[6]: #manifests
[7]: ./images/runbar-annotated-dark.png
[8]: ./images/input_tab_only_execute.png
[9]: ./images/deploy_to.png
[10]: ./images/view_logs_and_history.png
[11]: ./images/play_button.png
[12]: ./images/basicAnimate.gif
[13]: ./images/AddStage.png
[14]: ./images/AddJob.png
[15]: ./images/jobs.png
[16]: ./images/RunStage.png
[17]: https://www.ng.bluemix.net/docs/starters/container_pipeline.html#container_pipeline
[18]: ../../../tutorials/basicbuild
[19]: #add_stage
[20]: #add_job
[21]: ../deploy_ext
[22]: ./images/pipeline_settings_icon.png
[23]: https://www.ng.bluemix.net/docs/services/reqnsi.html#add_service
[24]: ../deploy_var
[25]: ./images/click_stage_run_number.png
[26]: ./images/diagram.jpg
-->
